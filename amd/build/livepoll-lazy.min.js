define(["jquery","core/log"],function(a,b){var c=this,d=function(d,e,g,h,i,j){c.apiKey=d,c.projectID=e,c.options=i,c.correctOption=j,c.pollKey=g,c.userKey=h,a(document).ready(function(){return void 0===firebase?void b.error("Firebase not found. Live poll will not work."):(c.firebase=firebase,void f())})},e=function(){c.votes=[],a.each(c.options,function(a){c.votes[a]=0})},f=function(){var a={apiKey:c.apiKey,authDomain:c.projectID+".firebaseapp.com",databaseURL:"https://"+c.projectID+".firebaseio.com",storageBucket:c.projectID+".appspot.com"};c.firebase.initializeApp(a),c.database=c.firebase.database(),c.auth=c.firebase.auth(),c.auth.onAuthStateChanged(function(a){a?c.fbuser=a:c.auth.signInAnonymously(),g(),h()})},g=function(){var b=c.database.ref("polls/"+c.pollKey);b.on("child_added",i),b.on("child_changed",i),b.on("child_removed",i);var d=c.database.ref("polls/"+c.pollKey+"/votes/"+c.userKey);d.once("value").then(function(b){if(b.val()){var c=b.val().option;a('.livepoll-votebtn[data-option="'+c+'"]').addClass("btn-success").removeClass("btn-primary")}})},h=function(){a(".livepoll-votebtn").on("click",function(){var b=a(this).data("option"),d={option:b},e=c.database.ref("polls/"+c.pollKey+"/votes/"+c.userKey);e.set(d),a(".livepoll-votebtn").addClass("btn-primary").removeClass("btn-success"),a(this).removeClass("btn-primary").addClass("btn-success")}).removeClass("disabled")},i=function(b){var d=b.val();e(),a.each(d,function(a,b){c.votes[b.option]++}),j()},j=function(){a.each(c.options,function(b){a("#vote-count-"+b).text(c.votes[b])})};return{init:d}});