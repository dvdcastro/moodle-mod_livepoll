define(["jquery","core/log","core/chartjs-lazy"],function(a,b,c){var d=this,e=function(c,e,h,i,j,k){d.apiKey=c,d.projectID=e,d.options=j,d.correctOption=k,d.pollKey=h,d.userKey=i,f(),a(document).ready(function(){return void 0===firebase?void b.error("Firebase not found. Live poll will not work."):(d.firebase=firebase,void g())})},f=function(){d.votes=[],a.each(d.options,function(a){d.votes[a]=0})},g=function(){var a={apiKey:d.apiKey,authDomain:d.projectID+".firebaseapp.com",databaseURL:"https://"+d.projectID+".firebaseio.com",storageBucket:d.projectID+".appspot.com"};d.firebase.initializeApp(a),d.database=d.firebase.database(),d.auth=d.firebase.auth(),d.auth.onAuthStateChanged(function(a){a?d.fbuser=a:d.auth.signInAnonymously(),l(),h(),i()})},h=function(){var a=d.database.ref("polls/"+d.pollKey);a.on("child_added",j),a.on("child_changed",j),a.on("child_removed",j),k()},i=function(){a(".livepoll-votebtn").on("click",function(){var b=a(this).data("option"),c={option:b},e=d.database.ref("polls/"+d.pollKey+"/votes/"+d.userKey);e.set(c)}).removeClass("disabled")},j=function(b){var c=b.val();f(),a.each(c,function(b,c){d.votes[c.option]++,b===d.userKey&&(a(".livepoll-votebtn").addClass("btn-primary").removeClass("btn-success"),a('.livepoll-votebtn[data-option="'+c.option+'"]').addClass("btn-success").removeClass("btn-primary"))}),k()},k=function(){d.chart.data.datasets[0].data=[],a.each(d.options,function(b){var c=d.votes[b];a("#vote-count-"+b).text(c),d.chart.data.datasets[0].data.push(c)}),d.chart.update()},l=function(){var b=document.getElementById("livepoll-chart").getContext("2d"),e=[],f=[];a.each(d.options,function(a,b){e.push(b),f.push(0)}),d.chart=new c(b,{type:"bar",data:{labels:e,datasets:[{label:"Votes",data:f}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})};return{init:e}});